<!DOCTYPE html>
<html>

<head>
	<title>Music Streamer</title>
</head>

<body>
	<h1>Music Player</h1>
	<select id="songList"></select>
	<button onclick="playSong()">Play</button>
	<audio id="audioPlayer" src="http://localhost:8081/" autoplay="false" controls></audio>

    <br>
    <select id="queue"></select>
	<script>
		console.log('client.js');
		async function loadSongs() {
			console.log('loadSongs');
			let response = await fetch('http://localhost:8080/songs');
			let songs = await response.json();
			let songList = document.getElementById('songList');
			songs.forEach(song => {
				let option = document.createElement('option');
				option.value = song;
				option.textContent = song;
				songList.appendChild(option);
			});
		}

		async function playSong() {
			console.log('playSong');
			let song = document.getElementById('songList').value;
            const url = `http://localhost:8080/stream/${song}`;
            console.log(await fetch(url));
			// document.getElementById('audioPlayer').src = `http://localhost:8080/stream/${song}`;
		}

		loadSongs();
        const queue = document.getElementById('queue');
        queue.addEventListener('click', async () => {
            while (queue.firstChild) {
                queue.removeChild(queue.firstChild);
            }
            console.log('queue change');
            let response = await fetch('http://localhost:8080/queue');
            let list = await response.json();
            console.log(JSON.stringify(list));
            list.forEach(song => {
                let option = document.createElement('option');
                option.value = song;
                option.textContent = song;
                queue.appendChild(option);
            });
        });
	</script>
</body>

</html>